<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Comprehensive Final Exam</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f6f7f8}
  .wrap{max-width:1000px;margin:auto;padding:16px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
  .q{font-weight:700;margin:8px 0}
  .opts label{display:block;margin:6px 0;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
  .short{width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
  .ok{background:#dcfce7} .bad{background:#fee2e2}
  button{padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;cursor:pointer}
  button.primary{background:#111;color:#fff;border-color:#111}
  .timer{position:fixed;top:12px;right:12px;background:#111;color:#fff;padding:6px 12px;border-radius:999px;font-weight:700;z-index:1000}
  .muted{opacity:.75}
  em{display:block;margin-top:6px;color:#4b5563}
  @media print{.timer,button{display:none}.card{break-inside:avoid}}
</style>
</head>
<body>
<div id="root" class="wrap"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
<script type="text/babel">
const {useState,useEffect}=React;
const KEY='final.exam.v1';
const toL=s=>(s==null?'':String(s)).trim().toLowerCase();
const tokenize=s=>toL(s).replace(/[^\\w\\s]/g,' ').split(/\\s+/).filter(Boolean);
const hasAll=(bag,req)=>req.every(w=>bag.has(w));
const jaccard=(a,b)=>{const A=new Set(a),B=new Set(b);const inter=[...A].filter(x=>B.has(x)).length;return inter/Math.max(1,A.size+B.size-inter)};
function gradeShort(user,rubric){if(typeof rubric==='string'){return toL(user)===toL(rubric)};const words=tokenize(user);const targets=Array.isArray(rubric.keywords?.[0])?rubric.keywords:[rubric.keywords||[]];let hits=0;for(const g of targets){if(hasAll(new Set(words),g.map(toL)))hits++}const cover=hits/Math.max(1,targets.length
